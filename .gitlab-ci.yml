image: op-gitlab.howest.be:4567/docker-registry/project-i-2019:master

stages:
  - build
  - QA
  - deploy

before_script:
  - ln -s "$MAVEN_LOCAL" ".m2"

build-jar:
  stage: build
  only: 
    - master
  except:
    changes:
      - documents/**/*
  script:
    - ./gradlew shadowJar
  artifacts:
    paths:
      - build/libs/

sonarqube:
  stage: QA
  except:
    changes:
      - documents/**/*
  script: ./gradlew sonarqube -Dsonar.host.url=http://172.18.18.129
  
validateHTML:
  stage: QA
  only:
    changes:
      -  src/main/resources/webroot/**/*.html
  script: ./gradlew validateHTML

test:
  stage: QA
  except:
    changes:
      - documents/**/*
  script: ./gradlew test

deploy:
  stage: deploy
  only:
    - master
  except:
    changes:
      - documents/**/*
  script: echo "TODO" 
